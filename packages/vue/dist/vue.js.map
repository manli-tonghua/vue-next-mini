{"version":3,"file":"vue.js","sources":["../../reactivity/src/dep.ts","../../reactivity/src/effect.ts","../../reactivity/src/baseHandlers.ts","../../reactivity/src/reactive.ts"],"sourcesContent":["import { ReactiveEffect } from \"./effect\";\n\nexport type Dep = Set<ReactiveEffect>\n\nexport const createDep = (effects?: ReactiveEffect[]): Dep => {\n    const dep = new Set<ReactiveEffect>(effects) as Dep\n    return dep\n}","// effect\n\nimport { createDep, Dep } from \"./dep\"\n\ntype KeyToDepMap = Map<any, Dep>\nconst targetMap = new WeakMap<any, KeyToDepMap>()\nexport function effect<T = any>(fn: () => T) {\n    const _effect = new ReactiveEffect(fn)\n    _effect.run()\n}\n\nexport let activeEffect: ReactiveEffect | undefined\n\nexport class ReactiveEffect<T = any> {\n    constructor(public fn: () => T) {}\n    run() {\n        activeEffect = this\n        return this.fn()\n    }\n}\n\n// 收集依赖\nexport function track(target: object, key: unknown){\n    if(!activeEffect) return\n    let depsMap = targetMap.get(target)\n    if(!depsMap) {\n        targetMap.set(target, (depsMap = new Map()))\n    }\n    // depsMap.set(key, activeEffect)\n    // console.log(targetMap)\n    let dep = depsMap.get(key)\n    if(!dep) {\n        depsMap.set(key, (dep = createDep()))\n    }\n    trackEffects(dep)\n}\n// 利用 dep 依次跟踪指定 key 的 所有 effect\nexport function trackEffects(dep: Dep) {\n    dep.add(activeEffect!)\n}\n\n// 触发依赖\nexport function trigger (target: object, key: unknown, newValue: unknown) {\n    const depsMap = targetMap.get(target)\n    if(!depsMap) return\n    const dep: Dep | undefined = depsMap.get(key)\n    if(!dep) {\n        return\n    }\n    triggerEffects(dep)\n}\n\n// 依次触发 dep 中保存的依赖\nexport function triggerEffects(dep: Dep) {\n    const effects = Array.isArray(dep) ? dep : Array.from(dep)\n    // 依次触发依赖\n    for(const effect of effects) {\n        triggerEffect(effect)\n    }\n}\n// 触发指定依赖\nexport function triggerEffect(effect: ReactiveEffect) {\n    effect.run()\n}","import { track, trigger } from \"./effect\"\n\nconst get = createGetter()\n\nfunction createGetter(){\n    return function get(target: object, key: string | symbol, receiver: object ) {\n        const res = Reflect.get(target, key, receiver)\n        // 依赖收集\n        track(target, key)\n        return res\n    }\n}\n\nconst set = createSetter()\nfunction createSetter(){\n    return function set(target: object, key: string | symbol, value: any, receiver: object) {\n        const res = Reflect.set(target, key, value, receiver)\n        // 触发依赖\n        trigger(target, key, value)\n        return res\n    }\n}\nexport const mutableHandlers: ProxyHandler<object> = {\n    get,\n    set\n}\n\n","import { mutableHandlers } from \"./baseHandlers\";\n\nexport const reactiveMap = new WeakMap<object, any>();\n\nexport function reactive(target: object) {\n    return createReactiveObject(target, mutableHandlers, reactiveMap)\n}\nfunction createReactiveObject(\n    target: object,\n    baseHandlers: ProxyHandler<any>,\n    proxyMap: WeakMap<object, any>\n) {\n    const existingProxy = proxyMap.get(target);\n    if (existingProxy) return existingProxy;\n    const proxy = new Proxy(target, baseHandlers)\n    proxyMap.set(target, proxy)\n    return proxy\n}"],"names":[],"mappings":"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"}