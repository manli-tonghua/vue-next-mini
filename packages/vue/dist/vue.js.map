{"version":3,"file":"vue.js","sources":["../../shared/src/index.ts","../../reactivity/src/dep.ts","../../reactivity/src/effect.ts","../../reactivity/src/baseHandlers.ts","../../reactivity/src/reactive.ts","../../reactivity/src/ref.ts","../../reactivity/src/computed.ts"],"sourcesContent":["export const isArray  = Array.isArray\n\nexport const isObject = (val: unknown) : boolean => val !== null && typeof val === 'object'\nexport const hasChanged = (value: any, oldValue: any) => !Object.is(value, oldValue)\nexport const isFunction = (val: unknown) : boolean => typeof val === 'function'","import { ReactiveEffect } from \"./effect\";\n\nexport type Dep = Set<ReactiveEffect>\n\nexport const createDep = (effects?: ReactiveEffect[]): Dep => {\n    const dep = new Set<ReactiveEffect>(effects) as Dep\n    return dep\n}","// effect\n\nimport { ComputedRefImpl } from \"./computed\"\nimport { createDep, Dep } from \"./dep\"\n\nexport type EffectScheduler = (...args: any[]) => any\n\ntype KeyToDepMap = Map<any, Dep>\nconst targetMap = new WeakMap<any, KeyToDepMap>()\nexport function effect<T = any>(fn: () => T) {\n    const _effect = new ReactiveEffect(fn)\n    _effect.run()\n}\n\nexport let activeEffect: ReactiveEffect | undefined\n\nexport class ReactiveEffect<T = any> {\n    \n    computed?: ComputedRefImpl<T>\n    constructor(public fn: () => T, public scheduler: EffectScheduler | null = null) {}\n    run() {\n        activeEffect = this\n        return this.fn()\n    }\n}\n\n// 收集依赖\nexport function track(target: object, key: unknown){\n    if(!activeEffect) return\n    let depsMap = targetMap.get(target)\n    if(!depsMap) {\n        targetMap.set(target, (depsMap = new Map()))\n    }\n    // depsMap.set(key, activeEffect)\n    // console.log(targetMap)\n    let dep = depsMap.get(key)\n    if(!dep) {\n        depsMap.set(key, (dep = createDep()))\n    }\n    trackEffects(dep)\n}\n// 利用 dep 依次跟踪指定 key 的 所有 effect\nexport function trackEffects(dep: Dep) {\n    dep.add(activeEffect!)\n}\n\n// 触发依赖\nexport function trigger (target: object, key: unknown, newValue: unknown) {\n    const depsMap = targetMap.get(target)\n    if(!depsMap) return\n    const dep: Dep | undefined = depsMap.get(key)\n    if(!dep) {\n        return\n    }\n    triggerEffects(dep)\n}\n\n// 依次触发 dep 中保存的依赖\nexport function triggerEffects(dep: Dep) {\n    const effects = Array.isArray(dep) ? dep : Array.from(dep)\n    // 依次触发依赖\n    for(const effect of effects) {\n              triggerEffect(effect)\n        }\n    // for(const effect of effects) {\n    //    if(effect.computed) {\n    //       triggerEffect(effect)\n    //    }\n    // }\n    // for(const effect of effects) {\n    //     if(!effect.computed) {\n    //         triggerEffect(effect)\n    //     }\n    // }\n}\n// 触发指定依赖\nexport function triggerEffect(effect: ReactiveEffect) {\n    console.log(effect,'0000')\n    if(effect.scheduler) {\n        effect.scheduler()\n    }else {\n        effect.fn()\n    }\n}","import { track, trigger } from \"./effect\"\n\nconst get = createGetter()\n\nfunction createGetter(){\n    return function get(target: object, key: string | symbol, receiver: object ) {\n        const res = Reflect.get(target, key, receiver)\n        // 依赖收集\n        track(target, key)\n        return res\n    }\n}\n\nconst set = createSetter()\nfunction createSetter(){\n    return function set(target: object, key: string | symbol, value: any, receiver: object) {\n        const res = Reflect.set(target, key, value, receiver)\n        // 触发依赖\n        trigger(target, key, value)\n        return res\n    }\n}\nexport const mutableHandlers: ProxyHandler<object> = {\n    get,\n    set\n}\n\n","import { isObject } from \"packages/shared/src/index\";\nimport { mutableHandlers } from \"./baseHandlers\";\n\nexport const reactiveMap = new WeakMap<object, any>();\n\nexport function reactive(target: object) {\n    return createReactiveObject(target, mutableHandlers, reactiveMap)\n}\nfunction createReactiveObject(\n    target: object,\n    baseHandlers: ProxyHandler<any>,\n    proxyMap: WeakMap<object, any>\n) {\n    const existingProxy = proxyMap.get(target);\n    if (existingProxy) return existingProxy;\n    const proxy = new Proxy(target, baseHandlers)\n    proxyMap.set(target, proxy)\n    return proxy\n}\n\nexport const toReactive = <T extends unknown>(value: T) : T => isObject(value) ? reactive(value as object) : value","import { hasChanged } from \"packages/shared/src/index\"\nimport { activeEffect, trackEffects, triggerEffect, triggerEffects } from \"./effect\"\nimport { toReactive } from \"./reactive\"\nimport { createDep, Dep } from \"./dep\"\n\nexport function ref (value: unknown) {\n    return createRef(value, false)\n}\nfunction createRef(rawValue: unknown, shallow: boolean) {\n    if(isRef(rawValue)) {\n        return rawValue\n    }\n    return new RefImpl(rawValue, shallow)\n}\n\nclass RefImpl<T> {\n    private _value: T\n    private _rawValue: T\n    public dep?: Dep = undefined\n    public readonly __v_isRef = true\n    constructor(value : T, public readonly  __v_isShallow: boolean) {\n        this._rawValue = value\n        this._value = __v_isShallow ? value : toReactive(value)\n    }\n    get value() {\n        trackRefValue(this)\n        return this._value\n    }\n    \n    set value(newVal) {\n        if(hasChanged(newVal, this._rawValue)) {\n            this._rawValue = newVal\n            this._value = toReactive(newVal)\n            triggerRefValue(this)\n        }\n    }\n}\n\nexport function trackRefValue(ref) {\n    if(activeEffect) {\n        trackEffects(ref.dep || (ref.dep = createDep()))\n    }\n}\n\nexport function triggerRefValue(ref) {\n    if(ref.dep) {\n        triggerEffects(ref.dep)\n    }\n}\n\n// 是否为ref\nexport function isRef(r: any): boolean {\n    return !!(r && r.__v_isRef === true)\n}","import { isFunction } from \"packages/shared/src/index\"\nimport { Dep } from \"./dep\"\nimport { ReactiveEffect } from \"./effect\"\nimport { trackRefValue, triggerRefValue } from \"./ref\"\n\nexport class ComputedRefImpl<T> {\n    \n    public dep?: Dep = undefined\n    private _value!: T\n    public readonly effect: ReactiveEffect<T>\n    public readonly __v_isRef = true\n    public _dirty = true\n    constructor(getter: () => any) {\n        this.effect = new ReactiveEffect(getter, () => {\n            if(!this._dirty) {\n                this._dirty = true\n                triggerRefValue(this)\n            }\n        })\n        this.effect.computed = this\n    }\n    \n    get value() {\n        trackRefValue(this)\n        if(this._dirty){\n            this._dirty = false\n            this._value = this.effect.run()\n        }\n        return this._value\n    }\n}\n\nexport function computed(getterOrOptions) {\n    let getter\n    \n    const onlyGetter = isFunction(getterOrOptions)\n    \n    if(onlyGetter) {\n        getter = getterOrOptions\n    }\n    \n    const cRef = new ComputedRefImpl(getter)\n    return cRef\n}"],"names":[],"mappings":"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"}